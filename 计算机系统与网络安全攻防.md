# 计算机系统与网络攻击

#### 第一节课

平时30% 期末闭卷70%

#### 杂谈

- 出席很重要，但是不点名
- 早点可以带到教室吃
- 掌握三类语言
  - 面向过程	C语言
  - 面向对象	C++/Java
  - 脚本	Python

- 可以自己写操作系统的框架，锻炼

- 学会抓包、爬虫

- 纯真库 ip 物理地址映射表


##### everything

##### autoruns

process explorer

##### Wireshark

- 抓包工具

##### nslookup

- dns查询工具

##### whois 

- ip查询工具

##### google高级检索

- 查询域名下所属网站

##### Nmap

##### 火绒

##### procexp

##### Google Hacking

##### 防水墙

关注大量相同、近似ip归属地的同时的流量

- 如果公安机关要对访问外网进行信息收集，怎么查到信息？


## 绪论

- 物理攻击与社会工程学攻击
- 不要做重复的工作，学会自动化

## 网络嗅探与协议分析

- 爬虫和抓包是很重要的技术

### 网络嗅探(Sniff)

- 利用计算机网络接口截获流量中的数据报文

- 嗅探得到的是二进制格式报文

#### 攻击

- 内网渗透

#### 防御

- 监听流量
- 入侵检测

#### 实现机理

- 写内核驱动附在网卡驱动上，旁入每一条报文
- 常见嗅探器软件
  - Libpcap
- 抓包工具
  - Wireshark
  - 

#### 检测技术

#### 防范措施

- 安全网络拓补结构
- 

#### 网络踩点

- DNS和IP查询
- web信息搜索

#### 网络侦察

- tracert

ICMP报文

TTL加一递增，让每一个节点都回传一个过期(time excceed)的回包，从而打出节点转发路径

特殊的服务器被配置后，可以不响应tracert请求

### 主机扫描(ping 扫描)

有确认机制的协议都可以

- Nmap 	主机扫描程序

集成了多协议扫描

##### ping扫射

同时扫描大量的IP地址段，发现ip地址下主机是否活跃

##### 防范

防御：考虑ICMP通信的过滤策略

检测：入侵检测

### 端口扫描技术

- 端口负责网络应用服务

##### 目的

攻击者：找出可供攻击的网络服务

防御者：找出没有必要开放的端口

#### TCP扫描

- 三次握手
  - 调用connect() 函数进行连接
  - 无需特权即可发起
  - 日志审计会记录大量连接与错误，容易被检测
- SYN半开扫描
  - 不属于隐蔽扫描
  - 需要更用户权限定制SYN包
  - 目标主机不会记录建立连接

##### 隐蔽扫描方式

用特殊的TCP标志位躲避扫描

- FIN扫描
  - 只带FIN位
- Null扫描
  - 全为0
- XMAS扫描
  - FIN、URG、PUSH为一
- FTP扫描
  - PORT命令

#### UDP扫描

UDP只要有反馈ack就说明活跃，不可达就不活跃

#### 防范措施

- 入侵检测、系统扫描检测工具

- 防火墙定制规则
- 禁用不必要的服务

### 系统类型探查

探查活跃主机系统

- 主动探测

  - 端口扫描

    135端口可能是window

  - 应用服务旗标攫取

  - 主动协议栈指纹鉴别

​	主动发送报文，通过反馈获取信息

- 被动识别
  - 

抓包获取信息，不做出主动访问行为

- 防范
  - 没有太好的防御办法
  - 自行检查

### 网络服务类型探查

### 漏洞

- 设计缺陷
- 代码膨胀
- 软件实现缺陷

#### 漏洞扫描软件

考点

- SATAN
- ISS
- Nessus
- 

#### 防范

- 自己先扫描
- 集中更新、打补丁
- 检测漏洞扫描行为

### 网络查点

看似无害的信息被高水平攻击者利用

autoruns

- 禁止不必要的服务
- 不要暴露主机名
- 

## DoS拒绝服务攻击

Denial of service

利用**网络协议漏洞**或**其他系统以及应用软件的漏洞** **耗尽**被攻击目标**资源**，使得被攻击的计算机或网络**无法正常提供服务**，直至系统停止响应甚至崩溃的攻击方式。

### 原理

#### 资源耗尽

- 网络带宽
- 磁盘空间
- CPU和内存

#### 配置修改

修改或删除配置文件，使系统停止或效率降低

#### 系统缺陷

### 基本形式

#### 过载

#### 消息流

#### 信号接地

物理方法关闭网络

#### 粘住攻击

- TCP半连接耗尽资源

### 攻击分类

- SYN FLOOD

  - 特点

    - 使用IP欺骗技术，攻击来源无法定位

    - 在服务端无法区分TCP连接请求是否合法

    - 发动攻击时，只要很少的数据流量就可以产生显著的效果

      大量的SYN占据资源，并且占据的资源要经过重传若干次后，才释放资源

  - 防御措施

    - 

<img src="C:\Users\泰来\AppData\Roaming\Typora\typora-user-images\image-20240912094139281.png" alt="image-20240912094139281" style="zoom:33%;" />

- 死ping(ping of death)

- 泪滴(teardrop)

  - 特点

    - 信任IP碎片中的包的标题头所包含的信息来实现攻击
    - 发送重叠偏移的伪造分段

    ![image-20240912095027996](C:\Users\泰来\AppData\Roaming\Typora\typora-user-images\image-20240912095027996.png)

  - 防御

    - 服务器应用最新的服务包
    - 或者在设置防火墙时对分段进行重组，而不是转发它们

- Smurf攻击(反射攻击)
  - 特点

- Land攻击

  - 特点

    给自己发一个SYN包，源地址和目标地址都是自己。

    结果收到SYN包后，又发回ACK消息并创建一个空连接。

  - 

- 分布式拒绝服务攻击DDoS
  
  - 特点
    - 攻击者控制了大量的节点
    - 攻击者
      - 操纵整个攻击过程，它向主控端发送攻击命令。
      - 是攻击主控台，可以是网络上的任何一台主机
    - 主控端
      - 传递攻击命令
    - 代理端
      - 攻击的执行者
  
    协作的大型攻击
  
  - 应付DDoS攻击的策略
  
    - 机器学习
    - 网络策略

- 僵尸网络(Botnet) 

  - 特点

    - Zombie

      被包含恶意代码的Bot感染或能被远程控制的计算机

    - IRC

      利用IRC （Internet Relay Chat）协议进行通信和控制

    - Command & Control Server

      IRC Bot连接的IRC服务器称为命令和控制服务器，控制者通过该服务器发送命令，进行控制。

  - 检测

    - IDS方法
      - 提取指纹信息
    - 行为监测
      - 检测僵尸的行为模式，检测API、下载、各种调用
    - 主动诱捕
      - 蜜罐捕获样本，进一步监视和分析

## 缓冲区溢出

### 执行流控制

- 使用ret

用jmp和call无法跳转，程序中不一定有对应的硬编码地址

- ret功能

  - 相当于pop EIP
    - 将返回地址从栈顶弹出
    - 弹出的返回地址放入EIP

- strcpy

  - 原理

  后面的字符串过长时，会覆盖后面地址的数据

- 栈区结构

<img src="C:\Users\泰来\AppData\Roaming\Typora\typora-user-images\image-20240919093416972.png" alt="image-20240919093416972" style="zoom:50%;" />

### 内存构成

![image-20240924085804584](C:\Users\泰来\AppData\Roaming\Typora\typora-user-images\image-20240924085804584.png)

不同操作系统可能会有不同的内存构成

#### TEB

线程数据块

### 溢出种类

### 堆溢出

在堆区发生的溢出

#### new内存分配

new的底层是由malloc构造的，

### 堆与栈区别

- 堆
  - 进程相关
  - 初始由系统分配，可由库函数自行管理，也可完全托管给系统。用于存储程序动态分配的数据。
  - 程序员释放
- 栈
  - 线程相关
  - 在函数调用过程中用于传入参数、保存返回地址、存储局部变量的空间。
  - 自动维护

### 整型溢出

- 试图写入超过最大值的数，就会发生整数溢出



#### 分类

- 宽度溢出

尝试存储一个超过变量表示范围的大数到变量中

- 运算溢出

如果存储值是一个运算操作，稍后使用这个结果的程序的任何一部分都将错误的运行，因为这个计算结果是不正确的。

- 符号溢出

一个无符号的变量被看作有符号，或者一个有符号的变量被看作无符号

#### 特点

- 难以预知

- 难以发现

### 格式化溢出

## Web

### Web应用体系结构

#### B/S架构

- 客户端
  - 浏览器
    - HTML
    - CSS
    - JavaScript

![image-20240926090009645](C:\Users\泰来\AppData\Roaming\Typora\typora-user-images\image-20240926090009645.png)

### HTML

- 静态标记语言
- 动态生成页面

### Web服务器

- Web服务器软件

  - HTTP守护进程，处理浏览器访问请求
  - 动态生成页面并返回
  - 或以json格式返回数据

  负责按http协议收发请求/数据

### Web应用程序

#### MVC分层模型

- 表示层：接收Web客户端输入并显示结果
- 业务逻辑层：完成Web应用业务逻辑处理

- 数据访问层：访问数据库，执行增删查改

<img src="C:\Users\泰来\AppData\Roaming\Typora\typora-user-images\image-20240926091149011.png" alt="image-20240926091149011" style="zoom: 80%;" />

### 攻击面

#### SQL注入攻击

#### 跨站脚本攻击

主要攻击方向都是获取用户cookie，获取登录态

##### 持久型xss/存储型xss

攻击者编写xss脚本写入后台数据，在用户访问时，执行攻击代码

##### 非持久型xss/反射型xss

攻击者插入xss脚本，在网页中嵌入自己的内容；当用户点击该部分时返回恶意url

##### 防御

- 服务器端
  - 输入验证: 对用户提交数据进行尽可能严格的验证与过滤
  - 输出净化: HTMLEncode()方法
  - 消除危险的输入点
- 客户端
  - 提高浏览器访问非受信网站时的安全等级
  - 安全意识和浏览习惯

#### 网络钓鱼

- 架设钓鱼网站
- 发送大量欺骗垃圾邮件
- 滥用个人敏感信息

##### 钓鱼技巧

- 使用IP地址代替域名
- 注册发音相近或形似DNS域名:Unicode字符
- 多数真实的链接中混杂关键的指向假冒钓鱼网站的链接
- 对链接URL进行编码和混淆
- 攻击浏览器，隐藏消息内容的本质
- 假冒钓鱼网站的透明性
- 恶意软件安装浏览器助手工具
- 修改本地DNS域名和IP地址映射hosts文件

##### 防范措施

- 增强安全意识

#### 恶意木马与流氓软件下载

捆绑安装、黑色软件等

#### 网页木马

- WebShell 

​	网页注入使控制权移交

- 利用浏览器漏洞

#### 访问流量重定向

- 内嵌HTML标签

- 恶意script脚本
- 内嵌对象

## 恶意代码

计算机病毒被定义为，经过存储介质和网络进行传播，从一台计算机系统到另外一台计算机系统，未经授权认证破坏计算机系统完整性的程序或代码

### 分类

- 特洛伊木马

一种会在主机上未经授权就自己执行的恶意程序

- 病毒

  - 蠕虫

    自动传播自身的副本到其他计算机

病毒会复制（感染）其它文件

- 间谍软件

### 传播途径

- 通过某种途径传播，进入目标系统

- 通过修改系统设置实现随系统自启动
- 激活病毒载荷的预定功能

#### 传播方式

- 网络共享
- 电子邮件
- P2P 共享
- 系统及软件漏洞
- 移动磁盘传播

### 自启动特性

病毒在系统中的行为是基于病毒在系统中运行的基础上的，这就决定了病毒必然要通过对系统的修改，实现开机后自动加载的功能

启动方式：

- 服务和进程
- 嵌入系统正常进程
- 驱动
- 修改注册表
  - 注册表启动项
- 修改配置文件

### 常见行为

#### 隐性行为

- 下载特性



- 后门特性

后门程序及很多木马、蠕虫和间谍软件会在受感染的系统中开启并侦听某个端口，允许远程恶意用户来对该系统进行远程操控。

- 信息收集特性

- 文件感染特性

文件型病毒的一个特性是感染系统中部分/所有的可执行文件

病毒会将恶意代码插入到系统正常的可执行文件中，使得系统正常文件被破坏而无法运行，或使系统正常文件感染病毒而成为病毒体。



### 动态链接库

kernel32.dll

要有自己的代码段数据段，通过页表的形式，映射到所有进程的地址空间中，每个进程就都可以使用
